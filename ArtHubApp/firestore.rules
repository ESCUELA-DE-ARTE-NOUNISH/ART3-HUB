rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // User Profiles collection - Web3 wallet-based access
    match /user_profiles/{walletAddress} {
      allow read: if true; // Public read access for profiles
      allow create, update: if true; // Allow wallet-based operations via API
    }
    
    // Users collection (legacy) - users can read/write their own data
    match /users/{userId} {
      allow read, write: if true; // Simplified for Web3 wallet access
    }
    
    // User Subscriptions V6 - Firebase-based subscription management
    match /user_subscriptions_v6/{walletAddress} {
      allow read: if true; // Public read for subscription status
      allow create, update: if true; // Allow API-based subscription management
    }
    
    // User Sessions - wallet-based session management
    match /user_sessions/{sessionId} {
      allow read, write: if true; // Allow API-based session management
    }
    
    // User Analytics - tracking user behavior
    match /user_analytics/{analyticsId} {
      allow read, write: if true; // Allow API-based analytics
    }
    
    // NFTs collection - public read, API-managed writes
    match /nfts/{nftId} {
      allow read: if true; // Public read access for NFTs
      allow create, update: if true; // Allow API-based NFT management
      allow delete: if true; // Allow API-based deletion
    }
    
    // Chat Memory collection - user conversation history
    match /user_memory/{walletAddress} {
      allow read, write: if true; // Allow API-based chat memory management
    }
    
    // Conversation Sessions - AI chat sessions
    match /conversation_sessions/{sessionId} {
      allow read, write: if true; // Allow API-based conversation management
    }
    
    // Conversation Messages - AI chat messages
    match /conversation_messages/{messageId} {
      allow read, write: if true; // Allow API-based message management
    }
    
    // Assessment Responses - AI assessment data
    match /assessment_responses/{responseId} {
      allow read, write: if true; // Allow API-based assessment management
    }
    
    // Claimable NFTs - admin-managed claimable NFTs
    match /claimable_nfts/{nftId} {
      allow read: if true; // Anyone can read claimable NFTs
      allow write: if true; // Allow API-based claimable NFT management
    }
    
    // NFT Claims - tracking claimed NFTs
    match /nft_claims/{claimId} {
      allow read: if true; // Public read for claim verification
      allow create, update: if true; // Allow API-based claim management
    }
    
    // Admin wallets collection - Web3 admin management
    match /admin_wallets/{adminId} {
      // Allow read access for anyone to check if an address is admin
      allow read: if true;
      
      // Allow system to create and manage admin wallets
      allow create, update, delete: if true; // Allow API-based admin management
    }
    
    // Allow all other collections for Web3 app flexibility
    match /{document=**} {
      allow read, write: if true;
    }
  }
}